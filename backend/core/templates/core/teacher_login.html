{% load crispy_forms_tags %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Login</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
    <div class="container py-5" style="max-width: 520px;">
        <div class="card shadow-sm">
            <div class="card-body p-4">
                <h2 class="mb-3" id="loginHeading">Login</h2>
                <p class="text-muted" id="loginSubheading">Sign in to access your account.</p>

                <div class="mb-3">
                    <label class="form-label">I am a</label>
                    <div class="btn-group w-100" role="group" aria-label="Choose role">
                        <button type="button" class="btn btn-outline-primary role-choice" data-role="student" data-next="/student/">Student</button>
                        <button type="button" class="btn btn-outline-primary role-choice" data-role="teacher" data-next="/teacher-hub/">Teacher</button>
                        <button type="button" class="btn btn-outline-primary role-choice" data-role="school_admin" data-next="/admin/">School Admin</button>
                    </div>
                </div>

                <form method="post">
                    {% csrf_token %}
                    <input type="hidden" name="{{ redirect_field_name }}" id="redirectField" value="{{ redirect_field_value|default:'' }}">
                    {{ form|crispy }}
                    <button type="submit" class="btn btn-primary w-100">Login</button>
                </form>

                <div class="text-center text-muted small my-3">or</div>
                <div class="d-grid gap-2 mb-3">
                    <a class="btn btn-outline-dark" href="/accounts/google/login/">
                        Continue with Google
                    </a>
                    <a class="btn btn-outline-primary" href="/accounts/microsoft/login/">
                        Continue with Microsoft
                    </a>
                </div>
            </div>
        </div>
    </div>
    <script>
        (function () {
            var roleButtons = document.querySelectorAll(".role-choice");
            var redirectField = document.getElementById("redirectField");
            var heading = document.getElementById("loginHeading");
            var subheading = document.getElementById("loginSubheading");

            function setActive(button) {
                roleButtons.forEach(function (btn) {
                    btn.classList.remove("active");
                });
                button.classList.add("active");
                if (redirectField) {
                    redirectField.value = button.getAttribute("data-next") || "";
                }
                var roleLabel = button.textContent.trim();
                heading.textContent = roleLabel + " Login";
                subheading.textContent = "Sign in to access your " + roleLabel.toLowerCase() + " account.";
            }

            if (roleButtons.length) {
                var params = new URLSearchParams(window.location.search);
                var roleParam = params.get("role");
                var matched = Array.prototype.find.call(roleButtons, function (btn) {
                    return btn.getAttribute("data-role") === roleParam;
                });

                if (matched) {
                    setActive(matched);
                } else {
                    setActive(roleButtons[1]);
                }
                roleButtons.forEach(function (button) {
                    button.addEventListener("click", function () {
                        setActive(button);
                    });
                });
            }
        })();
    </script>
</body>
</html>
